<!DOCTYPE html>
<html>
<head>
    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>

    <script src="https://unpkg.com/leaflet.pm@0.13.0/dist/leaflet.pm.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@0.13.0/dist/leaflet.pm.css" />

</head>
<body>



<div id="mapid" style="width: 600px; height: 400px;"></div>
<script>

    var mymap = L.map('mapid').setView([51.505, -0.09], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        id: 'mapbox.streets'
    }).addTo(mymap);

    // define toolbar options
    var options = {
        position: 'topright', // toolbar position, options are 'topleft', 'topright', 'bottomleft', 'bottomright'
        drawMarker: false,  // adds button to draw markers
        drawPolygon: true,  // adds button to draw a polygon
        drawPolyline: false,  // adds button to draw a polyline
        editPolygon: true,  // adds button to toggle global edit mode
        deleteLayer: true   // adds a button to delete layers
    };

    // add leaflet.pm controls to the map
    mymap.pm.addControls(options);

    mymap.on('pm:create', function(shape) {
        var myBounds = shape.layer.getBounds();

        alert("polygon created, bounds are\nNW: " + myBounds.getNorthWest() + "\nNE: " + myBounds.getNorthEast() + "\nSE: " + myBounds.getSouthEast() + "\nSW: " + myBounds.getSouthWest());

        var lat = myBounds.getNorthWest().lat;
        var lng = myBounds.getNorthWest().lng;

        var boundingBox = {
            upperLeftLatitude: myBounds.getNorthWest().lat,
            upperLeftLongitude: myBounds.getNorthWest().lng,
            lowerRightLatitude: myBounds.getSouthEast().lat,
            lowerRightLongitude: myBounds.getSouthEast().lng
        };

        var blah = 1

        $.ajax({
            url: "http://localhost:8080/services/v1/selection",
            type: "POST",
            data: JSON.stringify(boundingBox),
            dataType: "json",
            contentType:"application/json; charset=utf-8",
            success: function (data, textStatus, jqXHR) {
                alert("success");
            },
            error: function (jqXHR, textStatus, errorThrown ) {
                alert("failed - " + textStatus);
            }

        });
    });


</script>


</body>
</html>
